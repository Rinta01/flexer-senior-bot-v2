# –§–ª–µ–∫—Å–µ—Ä —Å—Ç–∞—Ä—à–∏–π - Telegram –±–æ—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–µ–∂—É—Ä–Ω—ã–º–∏

![Python](https://img.shields.io/badge/Python-3.12+-blue)
![aiogram](https://img.shields.io/badge/aiogram-3.24+-green)
![License](https://img.shields.io/badge/License-MIT-yellow)

Telegram-–±–æ—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–æ—Ç–∞—Ü–∏–µ–π "–¥–µ–∂—É—Ä–Ω—ã—Ö" –≤ –¥—Ä—É–∂–µ—Å–∫–∏—Ö –≥—Ä—É–ø–ø–∞—Ö. –ë–æ—Ç –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ –≤—ã–±–∏—Ä–∞–µ—Ç –æ–¥–Ω–æ–≥–æ –¥–µ–∂—É—Ä–Ω–æ–≥–æ –∏–∑ –ø—É–ª–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤, –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—è, —á—Ç–æ –Ω–∏–∫—Ç–æ –Ω–µ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞.

## üìã –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –¥–µ–∂—É—Ä–Ω—ã—Ö** - –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –≤—ã–±–æ—Ä —Å–ª—É—á–∞–π–Ω–æ–≥–æ –¥–µ–∂—É—Ä–Ω–æ–≥–æ
- ‚úÖ **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ—Ç–∞—Ü–∏–µ–π** - –ì–∞—Ä–∞–Ω—Ç–∏—è –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π –≤ —Ç–µ–∫—É—â–µ–º —Ü–∏–∫–ª–µ
- ‚úÖ **–ü—Ä–æ—Å—Ç—ã–µ –∫–æ–º–∞–Ω–¥—ã** - `/join`, `/leave`, `/duty`, `/help`
- ‚úÖ **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** - –û–±—ä—è–≤–ª–µ–Ω–∏–µ –¥–µ–∂—É—Ä–Ω–æ–≥–æ —Å —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ–º –≤ –≥—Ä—É–ø–ø–µ
- ‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –≥—Ä—É–ø–ø –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- ‚úÖ **–ü–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏** - Unit –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.12+
- SQLite 3+ (–∑–∞–ø—Ä–æ—Å—ã - —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ macOS –∏ Linux)

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone https://github.com/Rinta01/flexer-senior-bot-v2.git
cd flexer-senior-bot-v2

# –°–æ–∑–¥–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
python -m venv venv
source venv/bin/activate  # Linux/Mac
# –∏–ª–∏
venv\Scripts\activate  # Windows

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -e ".[dev,db]"
```

### 2. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—å `.env` —Ñ–∞–π–ª:

```bash
cp .env.example .env
```

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å `.env`:

```env
BOT_TOKEN=your_telegram_bot_token
DATABASE_URL=sqlite+aiosqlite:///./flexer_senior.db
LOG_LEVEL=INFO
ENVIRONMENT=development
WEEKLY_DUTY_DAY=0  # 0=–ü–Ω, 1=–í—Ç, ..., 6=–í—Å
WEEKLY_DUTY_HOUR=10
WEEKLY_DUTY_MINUTE=0
```

### 3. –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

#### –õ–æ–∫–∞–ª—å–Ω–æ (—Å SQLite)

```bash
python -m src.bot
```

–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–Ω–∞ –≤ —Ñ–∞–π–ª–µ `flexer_senior.db`.

#### –° Docker Compose

```bash
docker-compose up -d

# –õ–æ–≥–∏
docker-compose logs -f bot
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** Docker Compose –∑–∞–ø—É—Å–∫–∞–µ—Ç –±–æ—Ç–∞ —Å SQLite –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —Ç–æ–º–µ `./data`.

```

## üìñ –ö–æ–º–∞–Ω–¥—ã

| –ö–æ–º–∞–Ω–¥–∞  | –û–ø–∏—Å–∞–Ω–∏–µ                              |
| -------- | ------------------------------------- |
| `/start` | –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É –∏ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ        |
| `/join`  | –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –ø—É–ª—É –¥–µ–∂—É—Ä–Ω—ã—Ö        |
| `/leave` | –í—ã–π—Ç–∏ –∏–∑ –ø—É–ª–∞ –¥–µ–∂—É—Ä–Ω—ã—Ö                |
| `/duty`  | –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â–µ–≥–æ –¥–µ–∂—É—Ä–Ω–æ–≥–æ –Ω–∞ –Ω–µ–¥–µ–ª—é |
| `/help`  | –ü–æ–ª–Ω–∞—è —Å–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º            |

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```

src/
‚îú‚îÄ‚îÄ bot.py # –ì–ª–∞–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ config.py # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ handlers/ # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥
‚îÇ ‚îú‚îÄ‚îÄ start.py
‚îÇ ‚îú‚îÄ‚îÄ join.py
‚îÇ ‚îú‚îÄ‚îÄ leave.py
‚îÇ ‚îî‚îÄ‚îÄ duty.py
‚îú‚îÄ‚îÄ services/ # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ ‚îú‚îÄ‚îÄ duty_manager.py # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ—Ç–∞—Ü–∏–µ–π
‚îÇ ‚îú‚îÄ‚îÄ user_manager.py # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—É–ª–æ–º
‚îÇ ‚îî‚îÄ‚îÄ notification.py # –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
‚îú‚îÄ‚îÄ database/ # –°–ª–æ–π –¥–∞–Ω–Ω—ã—Ö
‚îÇ ‚îú‚îÄ‚îÄ models.py # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îÇ ‚îú‚îÄ‚îÄ engine.py # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ë–î
‚îÇ ‚îî‚îÄ‚îÄ repositories.py # CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ middlewares/ # –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ middlewares
‚îî‚îÄ‚îÄ utils/ # –£—Ç–∏–ª–∏—Ç—ã
‚îú‚îÄ‚îÄ logger.py
‚îî‚îÄ‚îÄ validators.py

````

## üóÑÔ∏è –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

### TelegramUser

```python
- user_id (BigInteger, unique)
- username (String, optional)
- first_name (String)
- last_name (String, optional)
- is_active (Boolean)
````

### DutyPool

```python
- group_id (BigInteger, unique)
- group_title (String)
- current_cycle (Integer)
- is_active (Boolean)
```

### DutyAssignment

```python
- user_id (ForeignKey)
- pool_id (ForeignKey)
- week_number (Integer)
- assignment_date (DateTime)
- cycle_number (Integer)
- notification_sent (Boolean)
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã
pytest

# –° –æ—Ç—á—ë—Ç–æ–º –ø–æ–∫—Ä—ã—Ç–∏—è
pytest --cov=src

# HTML –æ—Ç—á—ë—Ç
pytest --cov=src --cov-report=html
open htmlcov/index.html
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

```
tests/
‚îú‚îÄ‚îÄ conftest.py                # –§–∏–∫—Å—Ç—É—Ä—ã
‚îú‚îÄ‚îÄ unit/                      # Unit —Ç–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ test_duty_manager.py
‚îÇ   ‚îú‚îÄ‚îÄ test_user_manager.py
‚îÇ   ‚îú‚îÄ‚îÄ test_validators.py
‚îÇ   ‚îî‚îÄ‚îÄ test_repositories.py
‚îî‚îÄ‚îÄ integration/               # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
    ‚îî‚îÄ‚îÄ test_handlers.py
```

## üîÑ –õ–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ –¥–µ–∂—É—Ä–Ω–æ–≥–æ

1. **–ü–æ–ª—É—á–∏—Ç—å –ø—É–ª –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** –≥—Ä—É–ø–ø—ã
2. **–ò—Å–∫–ª—é—á–∏—Ç—å —É–∂–µ –¥–µ–∂—É—Ä–∏–≤—à–∏—Ö** –≤ —Ç–µ–∫—É—â–µ–º —Ü–∏–∫–ª–µ
3. **–°–ª—É—á–∞–π–Ω—ã–π –≤—ã–±–æ—Ä** –∏–∑ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è
4. **–ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ü–∏–∫–ª–∞** - —Å–±—Ä–æ—Å –∏ –Ω–∞—á–∞–ª–æ –Ω–æ–≤–æ–≥–æ —Ä–∞—É–Ω–¥–∞

```python
# –ü—Ä–∏–º–µ—Ä: 3 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Ü–∏–∫–ª 1
–¶–∏–∫–ª 1:  Alice -> Bob -> Charlie
–¶–∏–∫–ª 2:  Bob -> Charlie -> Alice
```

## üìä –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ –ø—É–ª—É

```
User: /join
Bot: ‚úÖ –í—ã –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª–∏—Å—å –∫ –ø—É–ª—É –¥–µ–∂—É—Ä–Ω—ã—Ö!
Bot: üë• –£—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≤ –ø—É–ª–µ: 5
```

### –û–±—ä—è–≤–ª–µ–Ω–∏–µ –¥–µ–∂—É—Ä–Ω–æ–≥–æ

```
Bot: üéØ –î–µ–∂—É—Ä–Ω—ã–π –Ω–∞ –Ω–µ–¥–µ–ª—é #2
Bot: –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º, @alice! üéâ
Bot: –¢—ã –Ω–∞–∑–Ω–∞—á–µ–Ω –¥–µ–∂—É—Ä–Ω—ã–º –Ω–∞ —ç—Ç—É –Ω–µ–¥–µ–ª—é...
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞

–ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **APScheduler** –¥–ª—è –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ –¥–µ–∂—É—Ä–Ω–æ–≥–æ:

```python
# –ü—Ä–∏–º–µ—Ä: –ö–∞–∂–¥—ã–π –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ –≤ 10:00 UTC

WEEKLY_DUTY_DAY=0      # –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ (0=–ü–Ω, 6=–í—Å)
WEEKLY_DUTY_HOUR=10    # –ß–∞—Å
WEEKLY_DUTY_MINUTE=0   # –ú–∏–Ω—É—Ç–∞
```

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–õ–æ–≥–∏ –≤—ã–≤–æ–¥—è—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å —Å —É—Ä–æ–≤–Ω–µ–º, –∑–∞–¥–∞–Ω–Ω—ã–º –≤ `LOG_LEVEL`:

```
[2024-01-09 10:15:30] flexer_senior - INFO - Started polling...
[2024-01-09 10:15:45] flexer_senior - INFO - User joined pool
```

## üêõ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –æ–±—ë—Ä–Ω—É—Ç—ã –≤ try/except —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º:

```python
try:
    # –û–ø–µ—Ä–∞—Ü–∏—è –ë–î –∏–ª–∏ API
except Exception as e:
    logger.error(f"Error: {e}")
    # –í–æ–∑–≤—Ä–∞—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —á–∏—Ç–∞–µ–º–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ
```

## üì¶ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### –õ–æ–∫–∞–ª—å–Ω–æ (Development)

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å PostgreSQL –ª–æ–∫–∞–ª—å–Ω–æ
docker-compose up postgres
python -m src.bot
```

### Production —Å Docker

```bash
# –°–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑
docker build -t flexer-senior-bot .

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker run -d \
  --env-file .env \
  --name flexer-bot \
  flexer-senior-bot
```

### Production –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å PostgreSQL –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
2. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å systemd/supervisor –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–º
4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (systemd journal –∏–ª–∏ —Ñ–∞–π–ª—ã)

## ü§ù –£—á–∞—Å—Ç–∏–µ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

```bash
# –°–æ–∑–¥–∞—Ç—å feature branch
git checkout -b feature/your-feature

# –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã
pytest

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞
ruff check src/
mypy src/

# –ö–æ–º–º–∏—Ç –∏ push
git commit -am "feat: description"
git push origin feature/your-feature
```

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License - —Å–º. —Ñ–∞–π–ª LICENSE

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–û–±–Ω–∞—Ä—É–∂–∏–ª–∏ –æ—à–∏–±–∫—É? [–°–æ–∑–¥–∞–π—Ç–µ Issue](https://github.com/Rinta01/flexer-senior-bot-v2/issues)

## üéØ –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

- [ ] Web –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Discord
- [ ] –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–π –≥—Ä—É–ø–ø—ã
- [ ] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–µ–∂—É—Ä–Ω—ã—Ö (–≥—Ä–∞—Ñ–∏–∫)
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∑–∞ –¥–µ–Ω—å –¥–æ –¥–µ–∂—É—Ä—Å—Ç–≤–∞
- [ ] –ü—Ä–∏—á–∏–Ω—ã –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –¥–µ–∂—É—Ä–Ω–æ–≥–æ

---

**–°–æ–∑–¥–∞–Ω–æ —Å ‚ù§Ô∏è –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–µ–∂—É—Ä–Ω—ã–º–∏**
