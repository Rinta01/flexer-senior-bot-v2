# –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–µ–∂—É—Ä—Å—Ç–≤–∞

## –û–±–∑–æ—Ä

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥–µ–∂—É—Ä—Å—Ç–≤–∞. –ö–æ–≥–¥–∞ –±–æ—Ç –≤—ã–±–∏—Ä–∞–µ—Ç –¥–µ–∂—É—Ä–Ω–æ–≥–æ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–ª–∏ –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ `/force_pick`), –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∏–ª–∏ –æ—Ç–∫–∞–∑–∞—Ç—å—Å—è –æ—Ç –¥–µ–∂—É—Ä—Å—Ç–≤–∞.

## –°—Ç–∞—Ç—É—Å—ã –¥–µ–∂—É—Ä—Å—Ç–≤–∞

–í —Ç–∞–±–ª–∏—Ü–µ `duty_assignments` –¥–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `status` —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ –≤–æ–∑–º–æ–∂–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏:

- **PENDING** - –æ–∂–∏–¥–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è (–Ω–∞—á–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å)
- **CONFIRMED** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª –¥–µ–∂—É—Ä—Å—Ç–≤–æ
- **DECLINED** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫–∞–∑–∞–ª—Å—è
- **SKIPPED** - –¥–µ–∂—É—Ä—Å—Ç–≤–æ –ø—Ä–æ–ø—É—â–µ–Ω–æ (–¥–ª—è –±—É–¥—É—â–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)

## –ù–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞: /force_pick

–ö–æ–º–∞–Ω–¥–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—Ä—É—á–Ω—É—é –≤—ã–±—Ä–∞—Ç—å –¥–µ–∂—É—Ä–Ω–æ–≥–æ –≤ –æ–±—Ö–æ–¥ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è.

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**

```
/force_pick
```

**–ü–æ–≤–µ–¥–µ–Ω–∏–µ:**

- –í—ã–±–∏—Ä–∞–µ—Ç —Å–ª—É—á–∞–π–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ø—É–ª–∞ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Ç–µ–º, –∫—Ç–æ –Ω–µ –∑–∞–≤–µ—Ä—à–∏–ª —Ü–∏–∫–ª)
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω–µ –Ω–∞–∑–Ω–∞—á–µ–Ω –ª–∏ —É–∂–µ –¥–µ–∂—É—Ä–Ω—ã–π –Ω–∞ —Ç–µ–∫—É—â—É—é –Ω–µ–¥–µ–ª—é
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å inline-–∫–Ω–æ–ø–∫–∞–º–∏ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

## –ü—Ä–æ—Ü–µ—Å—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

### 1. –û–±—ä—è–≤–ª–µ–Ω–∏–µ –¥–µ–∂—É—Ä–Ω–æ–≥–æ

–ö–æ–≥–¥–∞ –±–æ—Ç –≤—ã–±–∏—Ä–∞–µ—Ç –¥–µ–∂—É—Ä–Ω–æ–≥–æ, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–∞–º–∏:

```
üéØ –î–µ–∂—É—Ä–Ω—ã–π –Ω–∞ –Ω–µ–¥–µ–ª—é #2

–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º, @username! üéâ

–¢—ã –≤—ã–±—Ä–∞–Ω –¥–µ–∂—É—Ä–Ω—ã–º –Ω–∞ —ç—Ç—É –Ω–µ–¥–µ–ª—é –∏ –æ—Ç–≤–µ—á–∞–µ—à—å –∑–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é
–º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –¥–ª—è –≥—Ä—É–ø–ø—ã.

–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥—Ç–≤–µ—Ä–¥–∏ –∏–ª–∏ –æ—Ç–∫–∞–∂–∏—Å—å:

[‚úÖ –ü—Ä–∏–Ω—è—Ç—å]  [‚ùå –û—Ç–∫–∞–∑–∞—Ç—å—Å—è]
```

### 2. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ (‚úÖ –ü—Ä–∏–Ω—è—Ç—å)

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**

- –¢–æ–ª—å–∫–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –Ω–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É
- –î—Ä—É–≥–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

- –°—Ç–∞—Ç—É—Å –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ `CONFIRMED`
- –°–æ–æ–±—â–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è:

```
üéØ –î–µ–∂—É—Ä–Ω—ã–π –Ω–∞ –Ω–µ–¥–µ–ª—é #2

@username –ø—Ä–∏–Ω—è–ª –¥–µ–∂—É—Ä—Å—Ç–≤–æ! ‚úÖ

–û—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –Ω–∞ —ç—Ç—É –Ω–µ–¥–µ–ª—é.

–£–¥–∞—á–∏! üí™
```

### 3. –û—Ç–∫–∞–∑ (‚ùå –û—Ç–∫–∞–∑–∞—Ç—å—Å—è)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

- –°—Ç–∞—Ç—É—Å –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ `SKIPPED`
- –°–æ–æ–±—â–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è:

```
üéØ –î–µ–∂—É—Ä–Ω—ã–π –Ω–∞ –Ω–µ–¥–µ–ª—é #2

@username –æ—Ç–∫–∞–∑–∞–ª—Å—è –æ—Ç –¥–µ–∂—É—Ä—Å—Ç–≤–∞ ‚ùå

–î–µ–∂—É—Ä—Å—Ç–≤–æ –±—É–¥–µ—Ç –ø—Ä–æ–ø—É—â–µ–Ω–æ.

–í –±—É–¥—É—â–µ–º –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä —Å–ª–µ–¥—É—é—â–µ–≥–æ –¥–µ–∂—É—Ä–Ω–æ–≥–æ.
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –í —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ –ø—Ä–∏ –æ—Ç–∫–∞–∑–µ –¥–µ–∂—É—Ä—Å—Ç–≤–æ –ø—Ä–æ—Å—Ç–æ –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ –ø—Ä–æ–ø—É—â–µ–Ω–Ω–æ–µ. –í –±—É–¥—É—â–µ–º –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä —Å–ª–µ–¥—É—é—â–µ–≥–æ –¥–µ–∂—É—Ä–Ω–æ–≥–æ –∏–∑ –ø—É–ª–∞.

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö

```python
class DutyStatus(enum.Enum):
    PENDING = "pending"
    CONFIRMED = "confirmed"
    DECLINED = "declined"
    SKIPPED = "skipped"

class DutyAssignment:
    status: Mapped[DutyStatus] = mapped_column(
        Enum(DutyStatus),
        default=DutyStatus.PENDING,
        nullable=False,
        index=True
    )
```

### Callback –¥–∞–Ω–Ω—ã–µ

–ö–Ω–æ–ø–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç callback_data –≤ —Ñ–æ—Ä–º–∞—Ç–µ:

- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ: `duty_confirm:{assignment_id}:{user_id}`
- –û—Ç–∫–∞–∑: `duty_decline:{assignment_id}:{user_id}`

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ callback –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
- –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ —Å—Ç–∞—Ç—É—Å `PENDING` (–Ω–µ–ª—å–∑—è –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –¥–≤–∞–∂–¥—ã)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏

## –§–∞–π–ª—ã

**–ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:**

- `src/handlers/force_pick.py` - –∫–æ–º–∞–Ω–¥–∞ `/force_pick`
- `src/handlers/duty_callbacks.py` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ callback'–æ–≤ –∫–Ω–æ–ø–æ–∫

**–ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**

- `src/database/models.py` - –¥–æ–±–∞–≤–ª–µ–Ω enum `DutyStatus` –∏ –ø–æ–ª–µ `status`
- `src/database/repositories.py` - –º–µ—Ç–æ–¥—ã `update_status()`, `get_by_id()`, `update_message_id()`
- `src/services/notification.py` - inline keyboard –≤ `announce_duty_assignment()`
- `src/bot.py` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤—ã—Ö handlers
- `src/handlers/start.py` - –æ–±–Ω–æ–≤–ª–µ–Ω–∞ —Å–ø—Ä–∞–≤–∫–∞

## –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä —Å–ª–µ–¥—É—é—â–µ–≥–æ** - –ø—Ä–∏ –æ—Ç–∫–∞–∑–µ —Å—Ä–∞–∑—É –≤—ã–±–∏—Ä–∞—Ç—å –¥—Ä—É–≥–æ–≥–æ –¥–µ–∂—É—Ä–Ω–æ–≥–æ
2. **–¢–∞–π–º–∞—É—Ç** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–º–µ—á–∞—Ç—å –∫–∞–∫ `SKIPPED` –µ—Å–ª–∏ –Ω–µ—Ç –æ—Ç–≤–µ—Ç–∞ –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤
3. **–ò—Å—Ç–æ—Ä–∏—è –æ—Ç–∫–∞–∑–æ–≤** - —Ç—Ä–µ–∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –æ—Ç–∫–∞–∑–æ–≤ –¥–ª—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏
4. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** - –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –≤ –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–æ–º—É –¥–µ–∂—É—Ä–Ω–æ–º—É
